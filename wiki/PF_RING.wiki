#summary Spinning up multiple instances of Snort/Suricata and Bro using PF_RING

= Setup =

Setup will automatically ask you how many PF_RING instances you'd like for Snort/Suricata and Bro (assuming
you choose Advanced Setup and you have multiple cores) and will tell you
how to adjust after the fact.

= Tuning =

If you want to change the number of PF_RING instances after running Setup, you can do the following.

== Snort/Suricata ==

  * Stop sensor processes:
{{{
sudo nsm_sensor_ps-stop
}}}
  * Edit {{{/etc/nsm/$HOSTNAME-$INTERFACE/sensor.conf}}} and change IDS_LB_PROCS to desired number of cores.
  * Start sensor processes:
{{{
sudo nsm_sensor_ps-start
}}}

If running Snort, the script automatically spawns $IDS_LB_PROCS instances
of Snort (using PF_RING), barnyard2, and snort_agent.<br>
If running Suricata, the script automatically copies $IDS_LB_PROCS into
suricata.yaml and then Suricata spins up the PF_RING instances itself.

== Bro ==
For Bro, you would edit {{{/opt/bro/etc/node.cfg}}} and change the {{{lb_procs}}}
variable, then do:
{{{
sudo broctl install && sudo broctl start
}}}

NOTE! An issue was recently discovered in Bro 2.1 when monitoring multiple interfaces with PF_RING that could result in traffic loss.  This issue is targeted for resolution in Bro 2.2.  In the meantime, if you're monitoring multiple interfaces with Bro, please disable Bro's PF_RING load balancing as follows:
{{{
sudo broctl stop
sudo sed -i 's|^lb_method=pf_ring|#lb_method=pf_ring|g' /opt/bro/etc/node.cfg
sudo sed -i 's|^lb_procs|#lb_procs|g' /opt/bro/etc/node.cfg
sudo broctl install && sudo broctl start
}}}
For more information on the Bro issue, please see <a href="http://tracker.bro-ids.org/bro/ticket/943">Bro Ticket #943</a>.