#summary Frequently Asked Questions

= NOTE: This FAQ was originally written for Security Onion 10.04.  Not all FAQ entries have been updated for Security Onion 12.04 yet. =

= What's the recommended procedure for installing Security Onion? =
[Installation Installation Procedure]

= What do I need to do if I'm behind a proxy? =
[Proxy Proxy Configuration]

= How do I install Security Onion updates? =
[Upgrade Upgrade Procedure]

= Why do I get Snorby/Suricata/Bro errors after upgrading the kernel and pfring packages? =
Please see the [Upgrade] page.

= Why is my disk filling up? =
Sguil uses netsniff-ng to record full packet captures to disk.  These pcaps are stored in /nsm/sensor_data/HOSTNAME-INTERFACE/dailylogs/.  There is an hourly cronjob at /etc/cron.d/sensor-clean that should delete old pcaps when the disk reaches 90% of capacity.  It's important to properly size your disk storage so that you avoid filling the disk to 100% before the next hourly purge runs.<br>

= Why do apt-get and the Update Manager show tcl8.5 as held back? =
[tcl tcl notes]

= Why do I get the following error when starting Sguil? =
{{{
Application initialization failed: no display name and no $DISPLAY environment variable
ERROR: Cannot fine the Iwidgets extension.
The iwidgets package is part of the incr tcl extension and is
available as a port/package most systems.
See http://www.tcltk.com/iwidgets/ for more info.
}}}
This is related to the previous question.  See [tcl tcl notes].

= What is the password for root/mysql/Sguil/Squert/Snorby/ELSA? =
[Passwords]

= How do I configure email for alerting and reporting? =
[Email]

= Where can I read more about the tools contained within Security Onion? =
[Tools]

= How do I configure a BPF for Snort/Suricata/Bro? =
[BPF]

= How do I enable/disable processes? =
http://blog.securityonion.net/2013/07/new-nsm-and-setup-packages-allow-you-to.html

= Why won't the ISO image boot on my machine? =
  * Did you verify the checksum of the downloaded ISO as described on the [Installation] page?  
  * Does your machine support 64-bit?  If not, then you'll need to obtain a 64-bit machine to use our 64-bit ISO image (recommended) or use your 32-bit machine by installing Ubuntu 12.04 32-bit and adding our PPA and packages as described on the [Installation] page.
  * If you think your machine does support 64-bit, but you're still having problems with our 64-bit ISO image, try downloading the Ubuntu 12.04 64-bit ISO image and seeing if it runs.  If it doesn't, then you should verify your 64-bit compatibility.

= Why does Security Onion use UTC? =
Security Onion uses UTC/GMT because that is the recommended/required setting for Sguil:<br>
<a href="http://osdir.com/ml/security.sguil.general/2008-09/msg00003.html">http://osdir.com/ml/security.sguil.general/2008-09/msg00003.html</a><br>
<a href="https://forums.snort.org/forums/linux/topics/barnyard-sguil-time-problem">https://forums.snort.org/forums/linux/topics/barnyard-sguil-time-problem</a><br>
<br>
Trying to use a non-UTC timezone can result in the following:<br>
- Time zones that have daylight saving time have a one-hour time warp twice a year.  This manifests itself in Sguil not being able to pull transcripts for events within that one-hour time period.  This is avoided by using UTC, since there is no daylight saving time.<br>
- Something similar can happen on a daily basis under certain conditions.  If there is a discrepancy between the OS timezone and the Sguil UTC settings, then Sguil will be unable to pull transcripts for events in a window of time around midnight coinciding with the timezone's offset from UTC.<br>
Additionally, UTC comes in quite handy when you have sensors in different time zones and/or are trying to correlate events with other systems or teams.<br>
The Setup wizard (/usr/bin/sosetup) does the following to set the OS and all services to UTC:
{{{
echo "Etc/UTC" | sudo tee /etc/timezone
sudo dpkg-reconfigure --frontend noninteractive tzdata
sudo service rsyslog restart
sudo cp /etc/localtime /var/ossec/etc/localtime
sudo chown root:ossec /var/ossec/etc/localtime
sudo service ossec restart
}}}
Our three primary web interfaces (Snorby, Squert, and ELSA) all allow you to render event timestamps in your local timezone.  ELSA by default will render timestamps in the timezone of your local browser (more info below) and Squert and Snorby allow you to change your timezone.  However, be aware that if you set a timezone in Squert, you'll be unable to request a transcript (this will be resolved in the next version).  If you set your local timezone in Snorby, make sure that you also set the same timezone in CapMe's timezone.php:<br>
http://blog.securityonion.net/2014/01/new-capme-package-allows-you-to.html

= Why are the timestamps in ELSA not in UTC? =

By default, ELSA will display timestamps in the timezone of your local browser.  You can force ELSA to always display timestamps in UTC/GMT by configuring the use_utc setting in your ELSA Preferences panel.

Known issue in ELSA 713 (old ELSA package):  If you access ELSA from a browser whose local timezone is not UTC *and* you haven't enabled the use_utc setting in your ELSA Preferences, then each search rolls the From time back the same number of hours as the UTC offset.  For example, suppose you login to ELSA and notice that the From defaults to 2013-05-05 18:01:50. When you then perform a search, the From changes to 2013-05-05 14:01:50.

The workaround is to enable the use_utc setting in your ELSA
Preferences (which is probably a good idea anyway to ensure that your
timestamps in ELSA match your timestamps in Sguil/Squert/Snorby):

1. Navigate to ELSA -> Preferences: 

[http://security-onion.googlecode.com/svn/wiki/images/elsa/elsa_prefs.png]

2. Select Actions -> Add New Preference: 

[http://security-onion.googlecode.com/svn/wiki/images/elsa/elsa_prefs_add.png]

3. Enter the following into the new Preference: 
{{{
Type = default_settings
Name = use_utc
Value = 1
}}}
[http://security-onion.googlecode.com/svn/wiki/images/elsa/elsa_prefs_utc.png]

= Where can I find interesting pcaps to replay? =
[Pcaps]

= What are the default firewall settings and how do I change them? =
[Firewall]

= Can I be alerted when an interface stops receiving traffic? =
[SensorStopsSeeingTraffic]

= What can I do to decrease the size of my MySQL database? =
You can lower the DAYSTOKEEP setting in /etc/nsm/securityonion.conf.

= Can Security Onion run in IPS mode? =
Running Security Onion as an IPS requires manual configuration and is not supported.  I talked about this on the Packet Pushers podcast:
http://packetpushers.net/show-95-security-onion-with-doug-burks-or-why-ids-rules-and-ips-drools/

= Why do I get segfaults when booting on VMware ESX? =
This is a known issue with Ubuntu 10.04 and ESXi 4.1 and is unrelated to Security Onion.  Please see:<br>
http://ubuntuforums.org/showthread.php?t=1674759<br>
https://bugs.launchpad.net/ubuntu/+source/linux/+bug/659422<br>

= Why does my VMware image rename eth0 to eth1? =
Usually this happens when you clone a VM.  VMware asks if you moved it or copied it.  If you select "copied", it will change the MAC address to avoid duplication.  At the next boot, Ubuntu's udev will see a new MAC address and create a new network interface (eth1).  To fix this:
{{{
sudo rm /etc/udev/rules.d/70-persistent-net.rules
sudo reboot
}}}

= What do I need to modify in order to have the log files stored on a different mount point? =

[NewDisk Adding a New Disk for /nsm]

= How do I change the fonts in the Sguil client? =

In the Sguil client, click the File menu and then go to "Change Font".  You can change both the Standard and Fixed fonts.

= How do I boot Security Onion to text mode (CLI instead of GUI)? =
In /etc/default/grub, change this line:<br>
{{{
GRUB_CMDLINE_LINUX_DEFAULT="splash quiet"
}}}
to:<br>
{{{
GRUB_CMDLINE_LINUX_DEFAULT="text"
}}}

Then run:<br>
{{{
sudo update-grub
}}}

For more information, please see:<br>
<a href="http://ubuntuforums.org/showthread.php?t=1690118">http://ubuntuforums.org/showthread.php?t=1690118</a>

In Security Onion 12.04, you can install our packages on top of Ubuntu Server (minimal installation, no GUI).

= How do I get Security Onion to recognize more than 4GB of RAM? =
Install the PAE kernel as described here:<br>
<a href="https://help.ubuntu.com/community/EnablingPAE">https://help.ubuntu.com/community/EnablingPAE</a>

Security Onion 12.04 has full 64-bit support which supports more than 4GB RAM by default.

= How do I disable the graphical Network Manager and configuring networking from the command line? =

<a href="http://code.google.com/p/security-onion/wiki/NetworkConfiguration">http://code.google.com/p/security-onion/wiki/NetworkConfiguration</a>

= I'm running Security Onion in a VM and the screensaver is using lots of CPU.  How do I change/disable the screensaver? =
  # Click Applications.<br>
  # Click Settings.<br>
  # Click Screensaver.<br>
  # Screensaver Preferences window appears.  Click the Mode dropdown and select "Disable Screen Saver" or "Blank Screen Only".<br>
  # Close the Screensaver Preferences window.<br>

= I'm currently running Snort.  How do I switch to Suricata? =
{{{
sudo nsm_sensor_ps-stop
sudo sed -i 's|ENGINE=snort|ENGINE=suricata|g' /etc/nsm/securityonion.conf
sudo rule-update 
sudo nsm_sensor_ps-start
}}}

= I'm currently running Suricata.  How do I switch to Snort? =
{{{
sudo nsm_sensor_ps-stop
sudo sed -i 's|ENGINE=suricata|ENGINE=snort|g' /etc/nsm/securityonion.conf
sudo rule-update
sudo nsm_sensor_ps-start
}}}

= How do I add a new user to Sguil? =
You can add new Sguil user accounts with the following:<br>
{{{
sudo nsm_server_user-add
}}}

= I get periodic MySQL crashes and/or error code 24 "out of resources" when searching in Sguil.  How do I fix that? =
First, stop sguil and mysql:
{{{
sudo nsm_server_ps-stop
sudo service mysql stop
}}}
Next, edit /etc/mysql/my.cnf and add the following in the [mysqld] section:
{{{
open-files-limit        = 4096
}}}
Finally, start mysql and sguil:
{{{
sudo service mysql start
sudo nsm_server_ps-start
}}}
For more information, please see:<br>
<a href="http://nsmwiki.org/Sguil_FAQ#I.27m_seeing_error_code_24_from_MySQL._How_do_I_fix_that.3F">http://nsmwiki.org/Sguil_FAQ#I.27m_seeing_error_code_24_from_MySQL._How_do_I_fix_that.3F</a><br>

If you continue to get "out of resources", you'll need to increase 4096 to a higher number.

= How can I remote control my Security Onion box? =
A few options:
  * You can use [FreeNX] but there tend to be issues with tcl/tk (described in the linked article)
  * <a href="http://www.xrdp.org/">xrdp</a> - sudo apt-get install xrdp 
  * "ssh -X" - any program started in the SSH session will be displayed on your local desktop (requires a local X server)

= How can I add and test local rules? = 
[AddingLocalRules Adding local rules and testing them with scapy]

= Why is the Snorby dashboard not displaying correctly?  Why do I have to restart the Sensor Cache job periodically? =
All known issues with the dashboard and sensor cache job have been resolved with the release of Snorby 2.5.1 in Security Onion 20120321:<br>
<a href="http://blog.securityonion.net/2012/03/security-onion-20120321-now-available.html">http://blog.securityonion.net/2012/03/security-onion-20120321-now-available.html</a>

= I've forgotten my Snorby password.  How do I reset it? =
First, open the Rails console:
{{{
cd /opt/snorby/
sudo RAILS_ENV=production bundle exec rails c
}}}
In the Rails console, reset your Snorby password as follows:
{{{
u = User.find_by_email("foo@bar.com")
u.password="NewUnencryptedPassword123"
u.password_confirmation="NewUnencryptedPassword123"
u.save
quit
}}}
= Why isn't Snorby showing GeoIP data properly? =
Try forcing the GeoIP job to run by doing the following.  First, open the Rails console:
{{{
cd /opt/snorby/
sudo RAILS_ENV=production bundle exec rails c
}}}
In the Rails console, initiate the GeoIP job:
{{{
Snorby::Jobs::GeoipUpdatedbJob.new(true).perform
quit
}}}

= How do I disable Snorby? =
  # Disable Snorby in the Apache configuration:
{{{
sudo a2dissite snorby
}}}
  # Set SNORBY_ENABLED=no in /etc/nsm/securityonion.conf.
  # Comment out the output database line in all barnyard2.conf files on all sensors:
{{{
sudo sed -i 's|output database: alert, mysql, user=root dbname=snorby host=127.0.0.1|#output database: alert, mysql, user=root dbname=snorby host=127.0.0.1|g' /etc/nsm/*/barnyard2*.conf
}}}
  # Restart barnyard2 on all sensors:
{{{
sudo nsm_sensor_ps-restart --only-barnyard2
}}}

= Why does Snort segfault every day at 7:01 AM? =
7:01 AM is the time of the daily PulledPork rules update.  If you're running Snort with the VRT ruleset, this includes updating the SO rules.  There is a known issue when running Snort with the VRT ruleset and updating the SO rules:<br>
<a href="https://groups.google.com/d/topic/pulledpork-users/1bQDkh3AhNs/discussion">https://groups.google.com/d/topic/pulledpork-users/1bQDkh3AhNs/discussion</a><br>
After updating the rules, Snort is restarted, and the segfault occurs in the OLD instance of Snort (not the NEW instance).  Therefore, the segfault is merely a nuisance log entry and can safely be ignored.

= Barnyard2 is failing with an error like "ERROR: sguil: Expected Confirm 13324 and got: Failed to insert 13324: mysqlexec/db server: Duplicate entry '9-13324' for key 'PRIMARY'".  How do I fix this? =

Sometimes, just restarting Barnyard will clear this up:
{{{
sudo nsm_sensor_ps-restart --only-barnyard2
}}}

Other times, restarting Sguild and then restarting Barnyard will clear it up:
{{{
sudo nsm_server_ps-restart
sudo nsm_sensor_ps-restart --only-barnyard2
}}}

If that doesn't work, then try also restarting mysql:
{{{
sudo service mysql restart
sudo nsm_server_ps-restart
sudo nsm_sensor_ps-restart --only-barnyard2
}}}

If that still doesn't fix it, you may have to perform MySQL surgery on the database "securityonion_db" as described in the Sguil FAQ:
<a href="http://nsmwiki.org/Sguil_FAQ#Barnyard_dies_at_startup.2C_with_.22Duplicate_Entry.22_error">http://nsmwiki.org/Sguil_FAQ#Barnyard_dies_at_startup.2C_with_.22Duplicate_Entry.22_error</a>

= Why does the Snorby worker fail with "ERROR: Process ID out of range."? =
The root cause is that the Snorby worker got into a failed state with the /opt/snorby/tmp/pids/delayed_job.pid file being empty. Snorby reads in the contents of this pid file and if it's empty, it results in "ERROR: Process ID out of range.".  Removing the empty pid file allows Snorby to start correctly.
{{{
sudo mv /opt/snorby/tmp/pids/delayed_job.pid /tmp/
sudo reboot
}}}
For more info, please see:
https://groups.google.com/d/topic/snorby/te4R1E6-VH4/discussion

We now delete the pid file at boot by default, so you should just be able to reboot to resolve this issue:
http://blog.securityonion.net/2013/11/new-snort-nsm-and-sostat-packages.html

= How do I access Xplico with a hostname instead of IP address? =
From Gianluca Costa:<br>
<br>
Xplico has embedded (in its PHP code) a Http-proxy, this proxy is used to show the web pages, emulating, for example, the original cache of the user.
By default the XI url must be an IP address (wiki: http://wiki.xplico.org/doku.php?id=interface#browser ), the only exception to this rule is the url http://demo.xplico.org (for obvious reasons).
If you use as url a name (not an ip) then XI give you a blank page, because XI searches your url in the decoded data.

To change this behavior you must modify the PHP code:<br>
 - file /opt/xplico/xi/cake/dispatcher.php<br>
 - replace demo.xplico.org with your host name (used in the url)<br>

= How do I run ntop on Security Onion? =
In the old Security Onion 10.04, Snorby was running on port 3000 (which ntop also defaults to).  In Security Onion 12.04, Snorby no longer runs on port 3000, so this shouldn't be an issue.

ntop defaults to port 3000, which is already being used by Snorby.  You can change ntop's port by editing /etc/default/ntop like this:
{{{
GETOPT="-w 0 -W 4000"
}}}
This will disable http and enable https on port 4000.  Thanks to Rod Green for the tip!

= What's the difference between a "server" and a "sensor"? =
box<br>
Definition: A physical or virtual machine running the Security Onion operating system.<br>
<br>
server<br>
Definition: A set of processes that receive data from sensors and allow analysts to see and investigate that data.  The set of processes includes sguild, mysql, and snorby.  The server is also responsible for ruleset management.<br>
Naming convention: The collection of server processes has a server name separate from the hostname of the box.  Security Onion always sets the server name to "securityonion".<br>
Configuration files: /etc/nsm/securityonion/<br>
Controlled by:  /usr/sbin/nsm_server <br>
<br>
server box<br>
Definition: A machine running the server processes.  May optionally be running sensor processes.<br>
Example 1: User runs Quick Setup on machine with hostname securityonion and two ethernet interfaces.  Setup creates a server and two sensors (securityonion-eth0 and securityonion-eth1).<br>
Example 2: User runs Advanced Setup and chooses Server.  Setup creates a server only (no sensor processes).<br>
<br>
sensor<br>
Definition: A set of processes listening on a network interface.  The set of processes currently includes Snort/Suricata, netsniff-ng, argus, prads, and bro (although this is in constant flux as we add new capabilities and find better tools for existing capabilities).<br>
Naming convention: $HOSTNAME-$INTERFACE<br>
Configuration files: /etc/nsm/$HOSTNAME-$INTERFACE/<br>
Example: sensor1-eth0<br>
Controlled by:  /usr/sbin/nsm_sensor<br>
<br>
sensor box<br>
Definition: A machine having one or more sensors that transmit to a central server.  Does not run server processes.  Pulls ruleset from server box.  (In some contexts, I refer to this a slave pulling rules from the master.)<br>
Example: A machine named sensor1 having sensors sensor1-eth0 and sensor1-eth1.<br>

= What's the directory structure of /nsm? =
[DirectoryStructure /nsm Directory Structure]

= Where do I send questions/problems/suggestions? =

[MailingLists Security Onion Mailing Lists]

= Why can't I upgrade past version 20110628? = 

If your /etc/nsm/securityonion.conf says:<br>
{{{
VERSION=20110628
}}}
<br>
and if running the upgrade says:<br>
{{{
Your Security Onion installation is up to date.
}}}
<br>
then a previous upgrade from 20110628 to 20110709 was interrupted.  This upgrade changed the config file format from spaces to equal signs.  Edit the VERSION in /etc/nsm/securityonion.conf as follows:<br>
{{{
VERSION=20110709
}}}
<br>
and then re-run the upgrade.<br>