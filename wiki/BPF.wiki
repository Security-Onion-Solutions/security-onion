#summary BPF support in Security Onion

= Snort/Suricata/Daemonlogger =

As of Security Onion 20120329, we have support for a central bpf.conf that is passed to Snort, Suricata, and daemonlogger.

First, make sure you're running Security Onion 20120329 or higher:<br>
http://securityonion.blogspot.com/2012/03/security-onion-20120329-now-available.html

This update will create a bpf.conf file for each sensor interface on your system.  For example, if you have two sensor interfaces (eth0 and eth1), you'll now have two bpf.conf files:
/etc/nsm/$HOSTNAME-eth0/bpf.conf
/etc/nsm/$HOSTNAME-eth1/bpf.conf

The NSM scripts now pass the "-F /etc/nsm/$HOSTNAME-$INTERFACE/bpf.conf" to Snort and Suricata and "-f /etc/nsm/$HOSTNAME-$INTERFACE/bpf.conf" to daemonlogger.  However, Suricata's afpacket mode currently doesn't support bpf.  I've created Suricata feature request #440 for this:<br>
<a href="https://redmine.openinfosecfoundation.org/issues/440">https://redmine.openinfosecfoundation.org/issues/440</a>

Once you've added your BPF to the proper bpf.conf file(s) for your sensor interface(s), restart the sensor processes using the following command:
{{{
sudo nsm_sensor_ps-restart
}}}

= Bro =

Since there is one Bro config for ALL interfaces on the machine (as opposed to Snort/Suricata/Daemonlogger where we have one config for each interface), it cannot use the above configuration.  The recommended way to configure a BPF for Bro is to add the following to local.bro:
{{{
redef cmd_line_bpf_filter = "whatever your filter is";
}}}
Then, push the new configuration and restart Bro:
{{{
sudo broctl install
sudo broctl restart
}}}